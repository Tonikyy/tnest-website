// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id              String    @id @default(cuid())
  email           String    @unique
  password        String
  name            String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  business        Business? @relation(fields: [businessId], references: [id])
  businessId      String?
  role            Role      @default(CUSTOMER)
  customerSettings CustomerSettings?
  bookedVacancies Vacancy[] @relation("BookedBy")
}

model CustomerSettings {
  id                       String   @id @default(cuid())
  userId                   String   @unique
  user                     User     @relation(fields: [userId], references: [id])
  notifyBookingReminders   Boolean  @default(true)
  notifyCancellationAlerts Boolean  @default(true)
  notifyMarketing          Boolean  @default(false)
  defaultMaxDistanceKm     Int      @default(10)
  defaultServiceType       String?
  homeAddress              String?
  shareLocationOnSearch    Boolean  @default(false)
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
}

model Business {
  id          String    @id @default(cuid())
  name        String
  type        String
  address     String?
  latitude    Float?
  longitude   Float?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  users       User[]
  vacancies   Vacancy[]
}

model Vacancy {
  id          String        @id @default(cuid())
  business    Business      @relation(fields: [businessId], references: [id])
  businessId  String
  startTime   DateTime
  duration    Int           // Duration in minutes
  serviceType String
  priceCents  Int            @default(0) // Customer price in cents (e.g. 6000 = 60 EUR)
  notes       String?
  status      VacancyStatus  @default(ACTIVE)
  bookedBy    User?         @relation("BookedBy", fields: [bookedById], references: [id])
  bookedById  String?
  bookedAt    DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

enum Role {
  USER
  BUSINESS
  CUSTOMER
  ADMIN
}

enum VacancyStatus {
  ACTIVE
  BOOKED
  CANCELLED
}
